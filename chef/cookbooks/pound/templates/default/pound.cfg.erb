######################################################################
## global options:

User		"www-data"
Group		"www-data"
#RootJail	"/chroot/pound"

## Logging: (goes to syslog by default)
##	0	no logging
##	1	normal
##	2	extended
##	3	Apache-style (common log format)
LogLevel	1

## check backend every X secs:
#Alive		30

## use hardware-accelleration card supported by openssl(1):
#SSLEngine	"<hw>"

# poundctl control socket
Control "/var/run/pound/poundctl.socket"

<%= node[:loadbalancer][:services].each { |svc|
<% if svc[:ssl]? %>
ListenHTTPS
<% else %>
ListenHTTP
<% end %>
#  Address <%= node[:loadbalancer][:listen][:address] %>
  Address 0.0.0.0
  Port svc[:external_port]
  xHTTP 0
<% if svc[:ssl]? %>
  Cert "/etc/pound/ssl.pem"
  #CAlist "/etc/pound/ssl/gd_intermediate_bundle.crt"
  HeadRemove "X-Forwarded-Proto"
  HeadRemove "X-SSL-.*"
  Ciphers "ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL"
  # pass along https hint
  AddHeader "X-Forwarded-Proto: https"
<% end %>

  Service
    <%= node[:loadbalancer][:backend].each { |be| 
      BackEnd
        Address be[:address]
        Port    svc[:external_port]
        TimeOut 150
      End
    }%>
  End
End
%>